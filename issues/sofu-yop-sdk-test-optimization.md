# sofu-yop-sdk 测试与文档优化任务

- [✅] 分析 src/SofuYopClient.php 与 tests/test.php 当前实现与测试情况
- [✅] 为 src 和 tests 中的公开方法/示例函数补充用途注释
- [✅] 检查 composer.json 自动加载与依赖配置是否合理
- [✅] 完善 README.md 内容（安装、快速开始、回调解密、本地联调与测试说明）
- [ ] 后续：如有需要，引入 PHPUnit 等自动化测试框架并补充单元测试

## 背景

本任务主要目标：

1. 优化 src 与 tests 的注释和示例，使使用方快速理解每个方法/函数的用途。
2. 检查当前方法设计是否可行（包括发起请求和解密回调）以及示例脚本是否可正常运行。
3. 完善 README 文档，为接入方提供安装、使用和测试说明。

## 简要说明

- `src/SofuYopClient.php`

  - 封装了基础的参数管理、签名生成、HTTP 请求发送以及回调报文解密逻辑。
  - 通过 `addParam` 累积业务参数，`get` / `post` 发送请求，`decryptPayload` 解密回调中的 `encrypted_data`。

- `tests/test.php`

  - 作为本地联调示例脚本，演示如何：
    - 构造支付请求并调用 `/api/pay/create` 接口；
    - 模拟接收回调并使用 `decryptPayload` 解密数据。
  - 需要开发者自行填写真实的 `appKey`、`privateKey` 和解密 key。

- `composer.json`
  - 使用 PSR-4 自动加载：`"Sofu\\Yop\\" => "src/"`。
  - 要求运行环境：PHP >= 7.2，且启用了 `curl`、`json`、`openssl` 扩展。

## 现状与建议

- 现状：
  - 核心逻辑清晰、依赖较少，适合作为轻量 SDK 使用。
  - 示例脚本可在正确配置密钥和网关的前提下直接运行，用于本地联调。
- 建议：
  - 如需更完善的回归保障，可在后续引入 PHPUnit，针对签名生成、回调解密等核心逻辑补充单元测试。

## 后续改进可能

- [ ] 抽象 HTTP 请求层，方便在单元测试中注入 mock，避免真实外部请求。
- [ ] 增加更多接口调用示例（查询订单、退款等）。
- [ ] 在 README 中补充对错误码和常见异常场景的说明。
